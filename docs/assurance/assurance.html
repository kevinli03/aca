<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Assurance Basics – Kevin’s Accounting Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Kevin’s Accounting Notes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../accounting/accounting.html"> 
<span class="menu-text">Accounting</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../assurance/assurance.html" aria-current="page"> 
<span class="menu-text">Assurance</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../business/business.html"> 
<span class="menu-text">Business</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../tax/tax.html"> 
<span class="menu-text">Tax</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../assurance/assurance.html">Assurance Basics</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assurance/assurance.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Assurance Basics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assurance/process.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assurance Process</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assurance/controls.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Internal Controls</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-to-assurance" id="toc-introduction-to-assurance" class="nav-link active" data-scroll-target="#introduction-to-assurance"><strong>Introduction to Assurance</strong></a>
  <ul class="collapse">
  <li><a href="#elements-of-assurance" id="toc-elements-of-assurance" class="nav-link" data-scroll-target="#elements-of-assurance">Elements of Assurance</a></li>
  <li><a href="#levels-of-assurance" id="toc-levels-of-assurance" class="nav-link" data-scroll-target="#levels-of-assurance">Levels of Assurance</a></li>
  <li><a href="#legal-requirements" id="toc-legal-requirements" class="nav-link" data-scroll-target="#legal-requirements">Legal Requirements</a></li>
  <li><a href="#sustainability-assurance" id="toc-sustainability-assurance" class="nav-link" data-scroll-target="#sustainability-assurance">Sustainability Assurance</a></li>
  </ul></li>
  <li><a href="#professional-ethics" id="toc-professional-ethics" class="nav-link" data-scroll-target="#professional-ethics"><strong>Professional Ethics</strong></a>
  <ul class="collapse">
  <li><a href="#ethical-codes" id="toc-ethical-codes" class="nav-link" data-scroll-target="#ethical-codes">Ethical Codes</a></li>
  <li><a href="#ethical-principles" id="toc-ethical-principles" class="nav-link" data-scroll-target="#ethical-principles">Ethical Principles</a></li>
  <li><a href="#threats-and-safeguards" id="toc-threats-and-safeguards" class="nav-link" data-scroll-target="#threats-and-safeguards">Threats and Safeguards</a></li>
  <li><a href="#data-protection-gdpr" id="toc-data-protection-gdpr" class="nav-link" data-scroll-target="#data-protection-gdpr">Data Protection (GDPR)</a></li>
  </ul></li>
  <li><a href="#agreeing-an-engagement" id="toc-agreeing-an-engagement" class="nav-link" data-scroll-target="#agreeing-an-engagement"><strong>Agreeing an Engagement</strong></a>
  <ul class="collapse">
  <li><a href="#obtaining-an-engagement" id="toc-obtaining-an-engagement" class="nav-link" data-scroll-target="#obtaining-an-engagement">Obtaining an Engagement</a></li>
  <li><a href="#audit-engagement-letters" id="toc-audit-engagement-letters" class="nav-link" data-scroll-target="#audit-engagement-letters">Audit Engagement Letters</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Assurance Basics</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This page covers the basics of assurance, ethical codes, and obtaining/accepting an assurance engagement. The content in this section is a part of the <strong>Assurance and Risk Fundamentals</strong> (certificate level) for the ACA qualification.</p>
<p><br></p>
<hr>
<section id="introduction-to-assurance" class="level1">
<h1><strong>Introduction to Assurance</strong></h1>
<section id="elements-of-assurance" class="level3">
<h3 class="anchored" data-anchor-id="elements-of-assurance">Elements of Assurance</h3>
<p>Assurance is when an independent professional (auditor) examines financial statements or sustainability reports, to assure investors and stakeholders of the “quality”/state of the firm. This assurance given by the independent professional assures investors and stakeholders of the accuracy of the information, allowing them to make choices.</p>
<p>There are three parties in any assurance engagement:</p>
<ol type="1">
<li><strong>Practitioner</strong>: the auditor or independent professional.</li>
<li><strong>Responsible Party</strong>: the firm/company that is being audited. Typically, we focus on the directors of this firm/company.</li>
<li><strong>Intended User</strong>: typically stakeholders such as shareholders, investors, banks, or anyone needing to know details about a firm’s financial performance.</li>
</ol>
<p>Assurance can take many different forms:</p>
<ul>
<li><strong>Statutory Audit</strong>: the auditing of financial statements, governed by accounting standards and reporting regulations.</li>
<li><strong>Sustainability Assurance</strong>: the auditing of a firm’s sustainability figures and reports.</li>
<li>Other assurance engagements, such as due diligence before performing transactions, internal controls assessment, fraud investigations.</li>
</ul>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Benefits and Limitations of Assurance
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Benefits:</p>
<ul>
<li>Independent scrutiny of the business by experts, which adds credibility to the firm’s financial statements.</li>
<li>Can help deter the appeal of fraud for those in the firm.</li>
<li>Draws attention to issues, such as ethical issues or weaknesses of internal controls.</li>
<li>Reduces risk of management bias.</li>
</ul>
<p>Limitations:</p>
<ul>
<li>Assurance does not provide 100% assurance for accuracy, since you cannot possibly test and check every transaction made by a firm (especially large firms).</li>
<li>Cannot solve potential issues of collusion fraud between auditors and companies.</li>
<li>Financial information often includes subjective matters, such as depreciation and provision for doubtful debts.</li>
<li>May rely on some sub-optimal evidence, such as management representations.</li>
</ul>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="levels-of-assurance" class="level3">
<h3 class="anchored" data-anchor-id="levels-of-assurance">Levels of Assurance</h3>
<p>Usually, when considering the accuracy of financial statements, auditors are concerned with <strong>materiality</strong>.</p>
<blockquote class="blockquote">
<p><strong>A mistake is material if its omission or misstatement could influence the economic decisions of users of the report.</strong></p>
</blockquote>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Materiality, Error, and Fraud
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>For example, for a $10 billion net profit business, a $1 mistatement is not substantial enough to influence the economic decisions of users of the report, so it is not material. However, a $1 billion mistatement could quite substantially change how users use the report.</li>
<li>The threshold of materiality is often set at some percentage of net income before tax (ex. 5%) or revenue (1-2%).</li>
<li>There is also a distinction between <strong>Error</strong> and <strong>Fraud</strong>. Error is considered a genuine mistake of the responsible party. Fraud is <u>intentional</u>: someone deliberately provides false information to mislead users.</li>
</ul>
</div>
</div>
</div>
<p>At the end of an engagement, the auditor needs to write an <strong>opinion</strong> on the level of assurance they can assure regarding the accuracy of the financial statements. There are two <strong>levels of assurance</strong>.</p>
<table class="table-bordered table-sm small caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Reasonable Assurance</th>
<th>Limited Assurance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>High level of assurance of accuracy, but not absolute.</td>
<td>Moderate/low level of assurance of accuracy.</td>
</tr>
<tr class="even">
<td>Conclusion expressed <strong>positively</strong>.</td>
<td>Conclusion expressed <strong>negatively</strong>.</td>
</tr>
<tr class="odd">
<td><blockquote class="blockquote">
<p><strong>In our opinion, the financial statements show a true and fair view.</strong></p>
</blockquote></td>
<td><blockquote class="blockquote">
<p><strong>Nothing has come to our attention that causes us to believe that the financial information is not true and fair.</strong></p>
</blockquote></td>
</tr>
<tr class="even">
<td>Used in statutory audits.</td>
<td>Used in all other engagements.</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The Expectations Gap
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Users and the public often misinterpret audit opinions to mean other things. This “expectation” of the public contrasting with what audit opinions actually claim is called the expectations gap.</p>
<table class="table-bordered table-sm small caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Public</th>
<th>Reality</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>The public often thinks the auditor detects all fraud and error.</td>
<td>This is not true, the auditor only provides reasonable assurance, not absolute assurance.</td>
</tr>
<tr class="even">
<td>The public often thinks auditors test 100% of transactions.</td>
<td>This is not true, most audits sample transactions to test.</td>
</tr>
<tr class="odd">
<td>The public often thinks auditors guarantee the accuracy of financial statements.</td>
<td>This is not true, the auditor only provides reasonable assurance, not absolute assurance.</td>
</tr>
<tr class="even">
<td>The public often thinks auditors guarantee the company will continue to survive for the forseeable future.</td>
<td>This is not true, the auditor only provides an opinion of the accuracy of financial statements. The financial statements themselves can paint a good or bad picture, the auditor only cares if it is accurate.</td>
</tr>
<tr class="odd">
<td>The public often thinks the balance sheet shows the true value of the company.</td>
<td>This is not true, valuation is done by separate teams.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="legal-requirements" class="level3">
<h3 class="anchored" data-anchor-id="legal-requirements">Legal Requirements</h3>
<p>In the UK, all companies are required to legally undergo a statutory audit of their financial statements every year, <em>unless</em> they meet a set of exemption criteria. This requirement and the exemptions are set by the <strong>Companies Act 2006</strong>.</p>
<p>To qualify for an exemption, a firm must <strong>not</strong> be an insurance, banking, or listed company. In addition, they must also meet two of the following exemption critera below:</p>
<ul>
<li>Firms that are in banking, insurance, or listed on a stock market <strong>must</strong> always undergo a statutory audit, even if they meet the criteria above.</li>
</ul>
<table class="table-bordered table-sm small caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Exemption After 6 April 2025 (2/3)</th>
<th>Exemption After 1 January 2016 (2/3)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Less</strong> than 50 employees on average.</td>
<td><strong>Less</strong> than 50 employees on average.</td>
</tr>
<tr class="even">
<td><strong>Less</strong> than £7.5m in total assets.</td>
<td><strong>Less</strong> than £5.1m in total assets.</td>
</tr>
<tr class="odd">
<td><strong>Less</strong> than £15m in turnover.</td>
<td><strong>Less</strong> than £10.2m in turnover.</td>
</tr>
</tbody>
</table>
<p><br></p>
</section>
<section id="sustainability-assurance" class="level3">
<h3 class="anchored" data-anchor-id="sustainability-assurance">Sustainability Assurance</h3>
<p>Sustainability is about meeting he needs of the present, without compromising the future from meeting their own needs. Sustainability consists of environmental, social, and governance (ESG) considerations.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Environmental, Social, and Governance (ESG)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="table-bordered table-sm small caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 34%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Environmental</th>
<th>Social</th>
<th>Governance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>About the planet. For example, emissions and pollution.</td>
<td>About the people. Diversity, inclusion, worker health, mental health, etc.</td>
<td>About company practices and ethics.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Because of growing demand from users for information regarding sustainability, assurance is needed to ensure that the reported sustainability metrics of a firm are accurate.</p>
<p>Currently, sustainability assurance and reporting is still a developing field, but several regulations already exist.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">IFRS ISSB</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Companies Act 2006 (UK)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">TCFD (UK)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">CSRD (EU)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false">Assurance</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>IFRS sustainability and disclosure standards are issued by the International Susstainability and Standards Board (ISSB). Their 4 key objectives are:</p>
<ol type="1">
<li>Develop standards for a global baseline of sustainability disclosures.</li>
<li>Meet the information needs of investors.</li>
<li>Enable companies to provide sustainability information to global capital markets.</li>
<li>To facilitate interoperability with disclosures that are jurisdiction-specific, as well as aimed at broader stakeholder groups.</li>
</ol>
<p>They consist of two standards:</p>
<ol type="1">
<li><strong>IFRS S1</strong>: General requirements for disclosure of sustainability-related financial information.</li>
<li><strong>IFRS S2</strong>: Climate-related disclosures.</li>
</ol>
<p>Note: ISSB do not have power to enforce these standards, and they are not legally required for companies (except in Brazil).</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>The strategic report within the Capanies Act includes some mandatory sustainability reporting requirements.</p>
<ul>
<li>Reporting of the principal risks and uncertainties facing the company, including sustainability risks.</li>
<li>Information about environmental, social, and community matters, employees, respect for human rights, anti-corruption, and anti-bribery matters.</li>
<li>Information about gender diversity within the company.</li>
<li>Climate related financial disclosures, such as management of climate-adjacent risks and opportunities.</li>
</ul>
<p>These are required reporting for firms in the UK.</p>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>The TCFD (Task force on climate-related financial disclosures) is a set of recommendations issued in 2017, recommending the reporting of:</p>
<ol type="1">
<li>Governance</li>
<li>Risk Management</li>
<li>Strategy</li>
<li>Metrics and Targets.</li>
</ol>
<p>In the UK, the TCFD recommendations are mandatory for listed companies. This is not the case in all countries.</p>
<p>IFRS S2 reporting standards are based on these TCFD recommendations.</p>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<p>The European Union’s Corporate Sustainability Reporting Directive (CSRD) came into effect in 2023. It requires the following:</p>
<ul>
<li>Disclosure about a company’s sustainibility related impacts, risks, and opportunities.</li>
<li>Disclosures to be reported in the annual report of a company.</li>
<li>Requires companies to seek assurance over their sustainability disclosures.</li>
</ul>
<p>All companies that have securities listed on an EU stock market <strong>must</strong> follow these directives. Any EU companies that are large (more than 250 employees, 50 million euro revenue) that are not listed must also follow the directives.</p>
<ul>
<li>Non-EU companies which generate more than 150 million in the EU that also have a EU listed subsidiary must also follow the directives. But this only comes into affect in 2028.</li>
</ul>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<p>The <em>international standard on sustainability assurance <strong>(ISSA) 5000</strong> general requirements for sustainability assurance engagements</em> was released in 2024. It provides a framework for how sustainability assurance is to take place.</p>
<p>The objectives of the ISSA 5000:</p>
<ul>
<li>The obtain reasonable assurance or limited assurance about whether the sustainability is free from material mistatement.</li>
<li>To express a conclusion on the sustainability information through a written report that conveys a audit conclusion, and describes the basis for the conclusion.</li>
</ul>
<p>The EU CSRD also has guidelines on how to obtain limited assurance for sustainability based on the <strong>European Sustainability Reporting Standards (ESRS)</strong>, and also provides a provision to move towards reasonable assurance.</p>
</div>
</div>
</div>
<p><br></p>
<p><br></p>
<hr>
</section>
</section>
<section id="professional-ethics" class="level1">
<h1><strong>Professional Ethics</strong></h1>
<section id="ethical-codes" class="level3">
<h3 class="anchored" data-anchor-id="ethical-codes">Ethical Codes</h3>
<p>Regulatory bodies set the rules for auditors and the auditing process. There are a few main regulatory bodies in the UK:</p>
<table class="table-bordered table-sm small caption-top table">
<colgroup>
<col style="width: 30%">
<col style="width: 70%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>ICAEW</strong> (Institute of Chartered Accountants in England and Wales)</td>
<td>Sets the code of ethics for member auditors/accountants. The ICAEW code is based on the internal code of ethics established by the IESBA.</td>
</tr>
<tr class="even">
<td><strong>FRC</strong> (Financial Reporting Council)</td>
<td>Oversees auditors, sets the ethical standards for audit work, and supervises corporate governance and financial reporting bodies. The FRC also has a professional oversight function.</td>
</tr>
<tr class="odd">
<td><strong>IESBA</strong> (International Ethics Standards Board for Accountants)</td>
<td>Develops the international code of ethics for auditors/accountants, which serves as the foundation for the ICAEW ethics code.</td>
</tr>
<tr class="even">
<td><strong>Recognised Supervisory Bodies</strong></td>
<td>Organisations like ICAEW that supervise auditors, and ensure compliance with ethical and professional standards. These bodies work together to set, monitor, and enforce ethical standards, ensuring public trust in audits/auditors.</td>
</tr>
</tbody>
</table>
<p>The ethical codes that these bodies set can be divided into two types:</p>
<table class="table-bordered table-sm small caption-top table">
<colgroup>
<col style="width: 30%">
<col style="width: 70%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Rule-Based Codes</strong></td>
<td>Set out specific, detailed requirements, like a checklist of what is and isn’t allowed. Ex. no gifts over £30.</td>
</tr>
<tr class="even">
<td><strong>Principle Based Codes</strong></td>
<td>Focus on broad principles that guide behaviour for a wide range of professional situations. They focus more on professional judgment rather than spelling out rules for every possible scenario. Ex. no gifts that could impair your objectivity (no specific max value). This is used by the ICAEW and IESBA, since they are more flexible and adaptable to new situations.</td>
</tr>
</tbody>
</table>
<p><br></p>
</section>
<section id="ethical-principles" class="level3">
<h3 class="anchored" data-anchor-id="ethical-principles">Ethical Principles</h3>
<p>ICAEW’s ethics code is mostly principle-based, but also has some specific rule-based codes for specific things. There are 5 fundamental ethical principles for ICAEW:</p>
<table class="table-bordered table-sm small caption-top table">
<colgroup>
<col style="width: 30%">
<col style="width: 70%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Integrity</strong></td>
<td>Be honest and straight forward.</td>
</tr>
<tr class="even">
<td><strong>Objectivity</strong></td>
<td>To not allow bias, conflict of interest, or undue influence to affect your business judgment.</td>
</tr>
<tr class="odd">
<td><strong>Professional Competence and Due Care</strong></td>
<td>Maintain your skills and knowledge to provide a competent service, and act in accordance with professional standards.</td>
</tr>
<tr class="even">
<td><strong>Confidentiality</strong></td>
<td>Respect confidentiality of information, do not disclose without proper authority.</td>
</tr>
<tr class="odd">
<td><strong>Professional Behaviour</strong></td>
<td>Comply with rules and regulations, avoid conduct that would discredit the occupation.</td>
</tr>
</tbody>
</table>
<p><strong>Independence</strong> is key to objectivity. <u>Independence of mind</u> is the ability to make decisions free from bias or influence. <u>Independence in appearance</u> is avoiding situations that may make a third party doubt your impartiality, even if you are already not biased.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
More on Independence
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Independence is not necessarily threatened if auditors use the client’s services, <strong>given</strong> the prices/services the auditors are using are also available to the public.</p>
<ul>
<li>Ex. Auditors can have mortgages with a bank they are auditing, as long as those mortgages and rates are publicly available, and the mortgage was obtained prior to the engagement.</li>
<li>However, if the bank, after learning of the auditor’s appointment, provides favourable mortgages to the auditors and only the auditors, then it is a conflict of interest.</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Types of Biases
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="table-bordered table-sm small caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 35%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>Bias</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Anchoring Bias</td>
<td>Tendency to use an initial piece of information, which subsequent information is assessed.</td>
<td>Say an item was $50, but now is on sale for $30. $30 might still be an overpay, but in the context of the original price, it seems cheap.</td>
</tr>
<tr class="even">
<td>Automation Bias</td>
<td>Tendency to blindly trust output generated from automated systems.</td>
<td>Blindly trusting the output from accounting software.</td>
</tr>
<tr class="odd">
<td>Availability Bias</td>
<td>Putting more weight on experiences that easily come to mind.</td>
<td>We tend to think of plane crash news stories far more than the millions who have safe plane journeys.</td>
</tr>
<tr class="even">
<td>Confirmation Bias</td>
<td>Disregarding information that does not fit our existing beliefs.</td>
<td>Common in politics.</td>
</tr>
<tr class="odd">
<td>Groupthink</td>
<td>Tendency for groups to reach a conclusion without critical reasoning.</td>
<td>Social media like Reddit.</td>
</tr>
<tr class="even">
<td>Overconfidence Bias</td>
<td>Overestimating one’s own abilities.</td>
<td>If you are experienced, you might not check your work as carefully and assume it is correct.</td>
</tr>
<tr class="odd">
<td>Representation Bias</td>
<td>Assuming the interactions/experiences you have are representative of all people.</td>
<td></td>
</tr>
<tr class="even">
<td>Selective Perception</td>
<td>Expectations influencing personal views.</td>
<td>If you expect something to be bad, you are more likely to look for the bad parts.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="threats-and-safeguards" class="level3">
<h3 class="anchored" data-anchor-id="threats-and-safeguards">Threats and Safeguards</h3>
<p>There are several common threats to ethical behaviour:</p>
<table class="table-bordered table-sm small caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 35%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>Threat</th>
<th>Description</th>
<th>Safeguards</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Self-Interest Threat</strong></td>
<td>When you have a financial or personal interest that may affect your judgment/bias. Ex. owning shares in a company you are auditing, or one client making up a large proportion of fees for your auditing firm.</td>
<td><ul>
<li>Make sure no audit team members have shares.</li>
<li>No accepting gifts unless they are very small in value.</li>
<li>Listed company’s audit fees should make no more than 10% of the audit firm’s income, and needs to be disclosed if it exceeds 5% (Add 5% to thresholds for non-listed companies).</li>
</ul></td>
</tr>
<tr class="even">
<td><strong>Self-Review Threat</strong></td>
<td>When you are in the position of reviewing your own work, or work by your team, previously did. Ex. auditing financial statements that you yourself produced.</td>
<td><ul>
<li>Accounting services can only be offered to the client if the services and audit are 2 separate teams, and work is mechanical/technical.</li>
<li>Tax calculations and valuations cannot be offered by the audit firm if the client is listed.</li>
</ul></td>
</tr>
<tr class="odd">
<td><strong>Advocacy Threat</strong></td>
<td>When you promote a clients position to a point where your objectivity is compromised. Ex. representing a firm in a legal dispute, yet also auditing them.</td>
<td><ul>
<li>Audit firm is not allowed to promote, deal in, or underwrite a client’s shares.</li>
<li>Audit firm cannot provide legal services in a legal case to the client.</li>
</ul></td>
</tr>
<tr class="even">
<td><strong>Familiarity Threat</strong></td>
<td>Having a long standing or close relationship with the client, making you more sympathetic to them. Ex. you are auditing a company which has your best friend as financial director.</td>
<td><ul>
<li><strong>Audit rotation</strong>: for listed companies, lead partner of audit must be changed every 5 years (can extend to 7 years in exceptional circumstances), and cannot return for 5 years.</li>
<li>Audit employees with personal relationships with client should not be on audit team.</li>
</ul></td>
</tr>
<tr class="odd">
<td><strong>Intimidation Threat</strong></td>
<td>When you are deterred from acting objectively by external pressures. Ex. the client threatens to replace you as auditor if you do not provide favourable audit conclusion.</td>
<td><ul>
<li>If partner of audit firm joins client, the firm should resign as auditor, and cannot take the audit for 2 years.</li>
<li>Audit employees with personal relationships with client should not be on audit team.</li>
</ul></td>
</tr>
<tr class="even">
<td><strong>Management Threat</strong> (UK Only)</td>
<td>When you or your firm that influences client management decisions, and your interests become aligned with the client management. Ex. you do consulting services for a client that influences their management decisions, then you audit them.</td>
<td><ul>
<li>Use the engagement letter to limit the involvement of the audit firm away from management decisions.</li>
<li>Regulations meaning providing consultant services means cannot be auditor.</li>
</ul></td>
</tr>
</tbody>
</table>
<p><br></p>
</section>
<section id="data-protection-gdpr" class="level3">
<h3 class="anchored" data-anchor-id="data-protection-gdpr">Data Protection (GDPR)</h3>
<p>General Data Privacy Regulations (GDPR) in the UK and EU restrict the way auditors can collect and store data.</p>
<ul>
<li>Auditors (and anyone) who processes personal information must ensure it is protected.</li>
<li>Individuals hve a right to access their personal data, and information on how it is being processed.</li>
<li>Individual data can only be held if the individual has opted in, or there is a specific legal duty.</li>
</ul>
<p>Disclosure of information is divided into two ways: right to disclose and duty to disclose.</p>
<table class="table-bordered table-sm small caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Right to Disclose</th>
<th>Duty to Disclose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>You have the option to disclose private information if the following conditions apply.</td>
<td>You <strong>must</strong> disclose private information if any of the following conditions apply.</td>
</tr>
<tr class="even">
<td><ul>
<li>Client has given permission.</li>
<li>Disclosure is in the “public interest”.</li>
<li>To defend the firm in a negligence claim.</li>
</ul></td>
<td><ul>
<li>Suspicions of money laundering.</li>
<li>Suspicions of criminal activity.</li>
<li>Quality review or investigation of a professional/regulatory body.</li>
</ul></td>
</tr>
</tbody>
</table>
<p><br></p>
<p><br></p>
<hr>
</section>
</section>
<section id="agreeing-an-engagement" class="level1">
<h1><strong>Agreeing an Engagement</strong></h1>
<section id="obtaining-an-engagement" class="level3">
<h3 class="anchored" data-anchor-id="obtaining-an-engagement">Obtaining an Engagement</h3>
<p>There are several ways to get clients for an audit engagement.</p>
<table class="table-bordered table-sm small caption-top table">
<colgroup>
<col style="width: 30%">
<col style="width: 70%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Tender</strong></td>
<td>A client needs an auditor, and opens up a bidding process where multiple audit firms present offers. The client will then select an auditor.</td>
</tr>
<tr class="even">
<td><strong>Advertise</strong></td>
<td><p>Using advertisements to get clients.</p>
<p>Note: you must stick to ethical guidelines. This includes not discrediting the profession - meaning you cannot claim you are better than other audit firm in quality, or that another firm does a poor job.</p></td>
</tr>
<tr class="odd">
<td><strong>Recommendation</strong></td>
<td>A client of yours recommends your audit firm to another firm. They then become your client.</td>
</tr>
</tbody>
</table>
<p>However, before you agree to be the auditor, ensure that a few things have been met:</p>
<ul>
<li>Ensure that you are professional qualified to act as an auditor.</li>
<li>Ensure there are no legal or ethical reasons for you to not be the auditor.</li>
<li>Ensure you have adequate resources (staff, budget) to complete the audit.</li>
<li>If there is a previous auditor, the current practitioner must communicate with them, and determine if there are any reasons not to accept (like ethical concerns). Permission must be granted by the responsible party for this communication, but if this permission is denied, the audit is almost always refused by the practitioner.</li>
</ul>
<p><br></p>
</section>
<section id="audit-engagement-letters" class="level3">
<h3 class="anchored" data-anchor-id="audit-engagement-letters">Audit Engagement Letters</h3>
<p>After accepting an engagement, an engagement letter (contract) needs to be set up. his engagement letter should include:</p>
<ol type="1">
<li>The extent of the auditor and management’s responsibilities.</li>
<li>The scope of the engagement, and the objectives of the audit.</li>
<li>The form of the reports that will be issued, and what reporting framework.</li>
<li>Level of access to books and records for evidence.</li>
<li>Restrictiosn on the auditor’s liability (if possible).</li>
<li>Fees and how they are calculated.</li>
</ol>
<p>The audit engagement letter serves as a contract that will minimise misunderstanding and ensure all parties know their roles in the audit.</p>
<p><br></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>