<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Inventory and Non-Current Assets – Kevin’s Accounting Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Kevin’s Accounting Notes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../accounting/accounting.html" aria-current="page"> 
<span class="menu-text">Accounting</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../assurance/assurance.html"> 
<span class="menu-text">Assurance</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../business/business.html"> 
<span class="menu-text">Business</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../tax/tax.html"> 
<span class="menu-text">Tax</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../accounting/asset.html">Inventory and NCA</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../accounting/accounting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Accounting Basics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../accounting/sales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sales and Purchases</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../accounting/asset.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Inventory and NCA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../accounting/equity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Equity and Capital</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#inventory" id="toc-inventory" class="nav-link active" data-scroll-target="#inventory"><strong>Inventory</strong></a>
  <ul class="collapse">
  <li><a href="#inventory-bookkeeping" id="toc-inventory-bookkeeping" class="nav-link" data-scroll-target="#inventory-bookkeeping">Inventory Bookkeeping</a></li>
  <li><a href="#inventory-count" id="toc-inventory-count" class="nav-link" data-scroll-target="#inventory-count">Inventory Count</a></li>
  <li><a href="#cost-and-nrv" id="toc-cost-and-nrv" class="nav-link" data-scroll-target="#cost-and-nrv">Cost and NRV</a></li>
  <li><a href="#valuation-methods" id="toc-valuation-methods" class="nav-link" data-scroll-target="#valuation-methods">Valuation Methods</a></li>
  <li><a href="#first-in-first-out-fifo" id="toc-first-in-first-out-fifo" class="nav-link" data-scroll-target="#first-in-first-out-fifo">First in First Out (FIFO)</a></li>
  <li><a href="#average-cost-avco" id="toc-average-cost-avco" class="nav-link" data-scroll-target="#average-cost-avco">Average Cost (AVCO)</a></li>
  </ul></li>
  <li><a href="#depreciation" id="toc-depreciation" class="nav-link" data-scroll-target="#depreciation"><strong>Depreciation</strong></a></li>
  <li><a href="#disposals" id="toc-disposals" class="nav-link" data-scroll-target="#disposals"><strong>Disposals</strong></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Inventory and Non-Current Assets</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This page covers information on current assets (such as inventory) and non-current assets (such as ppe). The content in this section is a part of the <strong>Accounting Fundamentals</strong> (certificate level) for the ACA qualification.</p>
<p><br></p>
<hr>
<section id="inventory" class="level1">
<h1><strong>Inventory</strong></h1>
<section id="inventory-bookkeeping" class="level3">
<h3 class="anchored" data-anchor-id="inventory-bookkeeping">Inventory Bookkeeping</h3>
<p>When buying inventory, we <mark>do not update the inventory account</mark>. For a transaction that increases inventory, we instead use the purchases account.</p>
<ul>
<li><strong>Dr Purchases</strong> £–</li>
<li><strong>Cr Cash/Payables</strong> £–</li>
</ul>
<p>However, at the end of the year, we need to know the closing inventory balance for both the balance sheet, and the calculation of cost of sales. Closing inventory consists of:</p>
<ul>
<li>Goods which have been purchased, bur not yet sold.</li>
<li>Goods which are not part of ‘cost of goods sold’ (see adjustments and accrual accounting).</li>
<li>An asset of the business, or held for resale and are classified as a current asset.</li>
</ul>
<p>The following sections will discuss how to value the closings inventory. At the close of the period, we will complete this transaction:</p>
<table class="table-bordered table-sm small caption-top table">
<colgroup>
<col style="width: 30%">
<col style="width: 70%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Dr Closing Inventory (Asset)</strong></td>
<td><p>This is an asset on the balance sheet, and will be the value of the inventory listed.</p>
<p>This figure will also become the opening inventory of the next period.</p></td>
</tr>
<tr class="even">
<td><strong>Cr Closing Inventory (Expense)</strong></td>
<td>This is a (negative) expense account on the income statement. It will be used alongside purchases and the previous period’s closing inventory to calculate cost of sales.</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Inventory and Service Organisations
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Some service based industries will have very few physical inventory. For example, netflix or financial services have very few inventory.</p>
<p>Instead, cost of sales will <strong>reflect the cost of providing the service to customers</strong>. This includes:</p>
<table class="table-bordered table-sm small caption-top table">
<colgroup>
<col style="width: 30%">
<col style="width: 70%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Direct Labour Costs</strong></td>
<td><ul>
<li>If you are offering a tax specialist to a company, their salary would be included in cost of sales.</li>
<li>If you are a pool cleaning company, then the pool cleaner should be included in the cost of sales.</li>
<li>See note below.</li>
</ul></td>
</tr>
<tr class="even">
<td><strong>Materials Used</strong></td>
<td><ul>
<li>If you are offering a pool cleaning company, then the pool cleaning chemicals would be included in the cost of sales.</li>
<li>Note the difference between expenses (recurring) and one-time purchases of non-current assets (like equipment).</li>
</ul></td>
</tr>
<tr class="odd">
<td><strong>Sales Commission</strong></td>
<td><ul>
<li>The commission or bonus earned by salespeople, specifically as a result of securing work from customers.</li>
</ul></td>
</tr>
</tbody>
</table>
<p>NOTE: costs incurred that are not directly related to the service are not included. For example, receptionists and their salary, the sales-persons team and their salary.</p>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="inventory-count" class="level3">
<h3 class="anchored" data-anchor-id="inventory-count">Inventory Count</h3>
<p>At the year end, the <strong>closing inventory</strong> is counted. This determines what inventory (what products, how many of each) we have remaining at the end of the year. There are 3 types of inventory: raw materials, works in progress, and finished goods (most common).</p>
<p>Often, you will not perform an inventory count/valuation on the exact date of the year end. For example, the year might end on 31 December, but the inventory count might not occur until 3rd January.</p>
<p>Thus, we need to account for the changes in inventory between 31 December (Year End) and 3rd January (Count Date) to accurately determine the contents of the inventory on the year end. The adjustment is as follows:</p>
<blockquote class="blockquote">
<p><strong>Adjustment to Count = Counted Inventory (on count date)</strong></p>
<p><strong>- Goods received from suppliers (between year end and count date)</strong></p>
<p><strong>+ goods sold to customers (between year end and count date)</strong></p>
<p><strong>+ goods returned to suppliers (between year end and count date)</strong></p>
<p><strong>- Goods returned by customers (between year end and count date)</strong></p>
</blockquote>
<p>These adjustments “undo” the changes that occur between the year end and count date, to properly reflect the inventory on the year-end date.</p>
<p><br></p>
</section>
<section id="cost-and-nrv" class="level3">
<h3 class="anchored" data-anchor-id="cost-and-nrv">Cost and NRV</h3>
<p>Once we have counted what inventory we have, we need to value them so we can add it to the balance sheet, as well as calculate cost of sales. inventory can be valued in two main ways:</p>
<table class="table-bordered table-sm small caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Cost (most common)</strong></td>
<td><ul>
<li>In cost valuation, inventory is valued at the cost of which the inventory was obtained.</li>
<li>Cost includes the actual inventory purchase price, import duties, delivery fees for the inventory from the supplier to you.</li>
<li>If you are converting raw materials into finished products, the cost of this production is also included in the cost valuation.</li>
</ul></td>
<td><ul>
<li>Ex. I bought inventory for £500, with a £50 delivery fee.</li>
<li>Thus, under cost valuation, the inventory would be valued at £550.</li>
</ul></td>
</tr>
<tr class="even">
<td><strong>Net Realisable Value (NRV)</strong></td>
<td><ul>
<li>In net realisable value (NRV), inventory is valued at the price it can be sold at.</li>
<li>The costs needed to enable the sale (ex. repairs, modification costs, selling costs) are deducted from the price the inventory can be sold at.</li>
</ul></td>
<td><ul>
<li>Ex. the inventory I have can be sold on the market at £500. I will need to make some modifications of £50 to make this sale.</li>
<li>Thus, under NRV, the inventory would be valued at £450.</li>
</ul></td>
</tr>
</tbody>
</table>
<p>On the balance sheet, <mark>inventory should be valued at the <strong>lower</strong> of either cost valuation or NRV valuation</mark>. This is part of the prudence principle: that we should underpromise and overdeliver.</p>
<ul>
<li>This valuation at the lower of either cost or NRV occurs on a product by product basis.</li>
<li>For example, if you have 3 products A, B, and C. Products A and B have lower NRV valuations, and C has a lower cost valuation. Thus, you should value A and B with NRV, and C with cost.</li>
</ul>
<p>Cost valuation is typically more common. This makes sense: companies usually look to profit off of inventory sales, so unless a good is damaged, out of fashion, or perished, etc., it is unlikely to have a NRV lower than cost.</p>
<p><br></p>
</section>
<section id="valuation-methods" class="level3">
<h3 class="anchored" data-anchor-id="valuation-methods">Valuation Methods</h3>
<p>Let us say you have adopted cost valuation for your inventory. But there is an issue:</p>
<blockquote class="blockquote">
<p>Imagine you are a company selling footballs. At the beginning of the year, you purchase 100 footballs for your inventory for £1/each. Then a few months later, you purchase 50 more of the same type of footballs for £1.5 each. Now you have 150 footballs. You sell 50 of them (they are all the same, so you just take 50). You have 100 left. But how much is each remaining football worth? £1.5? £1? £1.36?</p>
</blockquote>
<p>There are 3 main ways of valuing inventory based on cost (however, LIFO is not allowed under most international standards).</p>
<table class="table-bordered table-sm small caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>First in First Out (FIFO)</strong></td>
<td>FIFO assumes that when you sell the 50 (or however many) products, you are selling the inventory that you purchased first.</td>
<td>Since you are selling the inventory you purchased first, the closing inventory is mostly the products you purchased last. Thus, valuation is more based on the later purchase prices.</td>
</tr>
<tr class="even">
<td><strong>Average Cost (AVCO)</strong></td>
<td>AVCO assumes you just randomly sell 50 (or however many) products.</td>
<td>Since you are selling a random amount of products, we value the closing inventory as some sort of weighted average of purchase prices.</td>
</tr>
<tr class="odd">
<td><strong>Last in First Out (LIFO)</strong></td>
<td>LIFT assumes that when you sell the 50 (or however many) products, you are selling the inventory that you purchased last.</td>
<td>Since you are selling the inventory you purchased last, the closing inventory is the products you purchased first. Thus, valuation is more based on the older (possibly outdated) purchase prices.</td>
</tr>
</tbody>
</table>
<p>LIFO is not allowed under IFRS standards, because it often revolves around valuaing invnetory on outdated old prices. This means that it will underestimate the closing inventory (if assuming inflation).</p>
<p>For more details on FIFO and AVCO, see below.</p>
<p><br></p>
</section>
<section id="first-in-first-out-fifo" class="level3">
<h3 class="anchored" data-anchor-id="first-in-first-out-fifo">First in First Out (FIFO)</h3>
<p><br></p>
</section>
<section id="average-cost-avco" class="level3">
<h3 class="anchored" data-anchor-id="average-cost-avco">Average Cost (AVCO)</h3>
<p><br></p>
<p><br></p>
<hr>
</section>
</section>
<section id="depreciation" class="level1">
<h1><strong>Depreciation</strong></h1>
<p><br></p>
<p><br></p>
<hr>
</section>
<section id="disposals" class="level1">
<h1><strong>Disposals</strong></h1>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>